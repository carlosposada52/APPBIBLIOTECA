ALTER TABLE prestamo ADD CONSTRAINT fk_material_prestamo
FOREIGN KEY (id_material) REFERENCES material(id_material);


--------------------------------------------------------------


CREATE OR REPLACE TRIGGER tr_historial_prestamo
AFTER DELETE ON prestamo
FOR EACH ROW
BEGIN
  INSERT INTO historial_prestamo (
    id_prestamo, 
    id_usuario, 
    id_material, 
    fecha_prestamo, 
    fecha_devolucion
  ) VALUES (
    :OLD.id_prestamo,
    :OLD.id_usuario,
    :OLD.id_material, -- si no está como columna explícita, ajusta esto
    :OLD.fecha_prestamo,
    :OLD.fecha_devolucion
  );
END;
/

//crear tabla hostorial prestamo
CREATE TABLE historial_prestamo (
    id_historial        NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    id_prestamo         NUMBER NOT NULL,
    id_usuario          NUMBER NOT NULL,
    id_material         NUMBER NOT NULL,
    fecha_prestamo      DATE NOT NULL,
    fecha_devolucion    DATE NOT NULL,
    fecha_registro      DATE DEFAULT SYSDATE -- Fecha en que se registra en el historial
);


CREATE TABLE "FACULTAD" 
(
    "ID_FACULTAD" NUMBER(*,0) GENERATED ALWAYS AS IDENTITY 
    MINVALUE 1 MAXVALUE 9999999999999999999999999999 
    INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE, 
    "NOMBRE" VARCHAR2(40 BYTE), 
    "DESCRIPCION" VARCHAR2(20 BYTE)
)
SEGMENT CREATION IMMEDIATE
PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
NOCOMPRESS LOGGING
TABLESPACE "USERS"



CREATE TABLE TIPO_CONTRATO (
    ID_CONTRATO NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    TIPO VARCHAR2(20) NOT NULL,
    DESCRIPCION VARCHAR2(50) NOT NULL
);

CREATE TABLE PROFESOR (
    ID_PROFESOR NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    FACULTAD_ID NUMBER NOT NULL,
    IDUSUARIO NUMBER NOT NULL UNIQUE,
    ID_CONTRATO NUMBER NOT NULL,
    ESPECIALIDAD_ID NUMBER NOT NULL,
    DUI VARCHAR2(20),
    
    CONSTRAINT FK_PROFESOR_FACULTAD FOREIGN KEY (FACULTAD_ID) 
        REFERENCES FACULTAD(ID_FACULTAD),
    CONSTRAINT FK_PROFESOR_USUARIO FOREIGN KEY (IDUSUARIO) 
        REFERENCES USUARIO(IDUSUARIO),
    CONSTRAINT FK_PROFESOR_CONTRATO FOREIGN KEY (ID_CONTRATO) 
        REFERENCES TIPO_CONTRATO(ID_CONTRATO),
    CONSTRAINT FK_PROFESOR_ESPECIALIDAD FOREIGN KEY (ESPECIALIDAD_ID) 
        REFERENCES ESPECIALIDAD(ID_ESPECIALIDAD)
);


